# üî¨ –ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä R-—Å–∫—Ä–∏–ø—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ mtDNA
## `03.RefAltRepeatability.Function.R` ‚Äî –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–ß–¢–û –î–ï–õ–ê–ï–¢ –°–ö–†–ò–ü–¢?](#—á—Ç–æ-–¥–µ–ª–∞–µ—Ç-—Å–∫—Ä–∏–ø—Ç)
2. [–£–°–¢–ê–ù–û–í–ö–ê –ò –ü–û–î–ì–û–¢–û–í–ö–ê](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
3. [–ò–ú–ü–û–†–¢ –ë–ò–ë–õ–ò–û–¢–ï–ö (–ø–æ–¥—Ä–æ–±–Ω–æ)](#–∏–º–ø–æ—Ä—Ç-–±–∏–±–ª–∏–æ—Ç–µ–∫)
4. [–û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: analyze_mtDNA_repeats](#–æ—Å–Ω–æ–≤–Ω–∞—è-—Ñ—É–Ω–∫—Ü–∏—è)
5. [–í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò](#–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
6. [–ü–û–®–ê–ì–û–í–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï –ü–ê–ô–ü–õ–ê–ô–ù–ê](#–ø–æ—à–∞–≥–æ–≤–æ–µ-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ-–ø–∞–π–ø–ª–∞–π–Ω–∞)
7. [–§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –û–ë–†–ê–ë–û–¢–ö–ê](#—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–∏-–æ–±—Ä–∞–±–æ—Ç–∫–∞)
8. [–ì–õ–û–°–°–ê–†–ò–ô R-–°–ò–ù–¢–ê–ö–°–ò–°–ê](#–≥–ª–æ—Å—Å–∞—Ä–∏–π-r-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞)
9. [–ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò –ü–†–û–í–ï–†–ò–¢–¨](#–∫–∞–∫-–∑–∞–ø—É—Å—Ç–∏—Ç—å-–∏-–ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

---

## –ß–¢–û –î–ï–õ–ê–ï–¢ –°–ö–†–ò–ü–¢?

### üéØ –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç R-—Å–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –î–ù–ö** –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–∞–ª—å–Ω–æ–π –î–ù–ö (mtDNA).

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. **–ë–µ—Ä—ë—à—å –ø–æ–∑–∏—Ü–∏—é** –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–∞ –î–ù–ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∑–∏—Ü–∏—è 8473)
2. **–ò–∑–≤–ª–µ–∫–∞–µ—à—å –º–æ—Ç–∏–≤** (–∫–æ—Ä–æ—Ç–∫–∏–π –∫—É—Å–æ–∫ –î–ù–ö –≤–æ–∫—Ä—É–≥ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏)
3. **–ò—â–µ—à—å –≤—Å–µ –ø–æ—Ö–æ–∂–∏–µ –ø–æ–≤—Ç–æ—Ä—ã** –≤–æ –≤—Å–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ mtDNA (16 568 –Ω—É–∫–ª–µ–æ—Ç–∏–¥–æ–≤)
4. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ—à—å** Ref-–∞–ª–ª–µ–ª—å (–∏—Å—Ö–æ–¥–Ω—É—é –±—É–∫–≤—É) –∏ Alt-–∞–ª–ª–µ–ª—å (–º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –±—É–∫–≤—É)
5. **–§–∏–ª—å—Ç—Ä—É–µ—à—å** –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (—Å–∞–º–æ–ø–æ–≤—Ç–æ—Ä—ã, –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)
6. **–°–æ—Ö—Ä–∞–Ω—è–µ—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –≤ CSV-—Ñ–∞–π–ª—ã

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —á–∞—Å—Ç–æ –æ–¥–Ω–∞ –º—É—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç "—Å–ø—Ä—è—Ç–∞—Ç—å—Å—è" —Å—Ä–µ–¥–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, –Ω–∞–¥—ë–∂–Ω–∞—è –ª–∏ —ç—Ç–∞ –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

---

## –£–°–¢–ê–ù–û–í–ö–ê –ò –ü–û–î–ì–û–¢–û–í–ö–ê

### –®–∞–≥ 0: –ü—Ä–æ–≤–µ—Ä—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```r
# –ï—Å–ª–∏ —Ç—ã –≤–ø–µ—Ä–≤—ã–µ –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–∫—Ä–∏–ø—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã.
# –í—ã–ø–æ–ª–Ω–∏ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –û–î–ò–ù –†–ê–ó:

# –ë–∞–∑–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã (CRAN ‚Äî Comprehensive R Archive Network)
install.packages("dplyr")
install.packages("tidyr")
install.packages("stringdist")

# –ë–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞–∫–µ—Ç—ã (Bioconductor)
# –î–ª—è –Ω–∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("Biostrings")
BiocManager::install("IRanges")

# –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å—ë –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å:
library(Biostrings)  # –¥–æ–ª–∂–Ω–∞ –≤—ã–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
```

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–∞–Ω–Ω—ã–µ

```r
# –£–±–µ–¥–∏—Å—å, —á—Ç–æ FASTA-—Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ:
# c:\proga\REPEATABILITY\data\1_raw\Homo_sapients.mtDNA.fasta

# –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞:
file.exists("../data/1_raw/Homo_sapients.mtDNA.fasta")
# –î–æ–ª–∂–Ω–∞ –≤—ã–¥–∞—Ç—å: TRUE
```

---

## –ò–ú–ü–û–†–¢ –ë–ò–ë–õ–ò–û–¢–ï–ö

### üìö –ß—Ç–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ?

```r
library(Biostrings)   # –†–∞–±–æ—Ç–∞ —Å –î–ù–ö-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏
library(stringdist)   # –†–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏
library(IRanges)      # –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–∞ –≥–µ–Ω–æ–º–µ
library(dplyr)        # –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
library(tidyr)        # –ü–µ—Ä–µ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
```

**–†–∞–∑–±–µ—Ä—ë–º –∫–∞–∂–¥—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É:**

#### 1Ô∏è‚É£ **Biostrings** ‚Äî –æ—Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç—ã —Å –î–ù–ö

```r
# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?
# - DNAString: –æ–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –î–ù–ö-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
# - DNAStringSet: –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ FASTA)
# - readDNAStringSet(): —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è FASTA

# –ü—Ä–∏–º–µ—Ä:
mtDNA <- readDNAStringSet("path/to/file.fasta")
# mtDNA ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç DNAStringSet
mtDNA[[1]]  # –∏–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ç–∏–ø DNAString)

# –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫?
# DNAString –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –î–ù–ö:
# - —ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç 2 –±–∏—Ç–∞ –Ω–∞ –Ω—É–∫–ª–µ–æ—Ç–∏–¥ –≤–º–µ—Å—Ç–æ 8)
# - –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã (subseq, complement –∏ —Ç.–¥.)
```

#### 2Ô∏è‚É£ **stringdist** ‚Äî —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏

```r
# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?
# stringdist(string1, string2, method="hamming")
# –°—á–∏—Ç–∞–µ—Ç "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –•—ç–º–º–∏–Ω–≥–∞" ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –æ—Ç–ª–∏—á–∞—é—Ç—Å—è

# –ü—Ä–∏–º–µ—Ä:
stringdist("AGCT", "AGTT", method="hamming")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 (–æ—Ç–ª–∏—á–∞—é—Ç—Å—è –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 3)

stringdist("AGCT", "AGCT", method="hamming")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 (—Å–æ–≤–ø–∞–¥–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ)

# –ó–∞—á–µ–º?
# –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –Ω–µ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –∞ "–ø–æ—Ö–æ–∂–∏–µ" –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
# (—Å –¥–æ–ø—É—Å–∫–æ–º –Ω–∞ 1-2 –æ—à–∏–±–∫–∏)
```

#### 3Ô∏è‚É£ **IRanges** ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–∞ –≥–µ–Ω–æ–º–µ

```r
# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?
# IRanges(start, end): –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ [start, end]
# –£–¥–æ–±–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

# –ü—Ä–∏–º–µ—Ä:
range1 <- IRanges(start=100, end=150)
range2 <- IRanges(start=120, end=200)
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏?
overlapsAny(range1, range2)  # TRUE

# –í –Ω–∞—à–µ–º —Å–∫—Ä–∏–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
# - —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø–æ–≤—Ç–æ—Ä–æ–≤
# - —É–¥–∞–ª–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö (nested) –ø–æ–≤—Ç–æ—Ä–æ–≤
```

#### 4Ô∏è‚É£ **dplyr** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (data.frame)

```r
# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?
# –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –≤—ã–±–æ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
filter(df, condition)  # –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ —É—Å–ª–æ–≤–∏–µ TRUE
select(df, col1, col2) # –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏
mutate(df, new_col = expression)  # –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É
arrange(df, col1)      # –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–ª–æ–Ω–∫–µ
group_by(df, col)      # –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
summarise(df, count = n())  # –∞–≥—Ä–µ–≥–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Å—á—ë—Ç —Å—Ç—Ä–æ–∫)

# –ü—Ä–∏–º–µ—Ä:
df <- data.frame(pos = c(100, 200, 300), nuc = c("A", "T", "G"))
df %>%
  filter(pos > 150) %>%
  select(nuc)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å—Ç—Ä–æ–∫–∏ 200 –∏ 300, —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∞ nuc
```

#### 5Ô∏è‚É£ **tidyr** ‚Äî –ø–µ—Ä–µ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

```r
# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç?
# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è "—à–∏—Ä–æ–∫–∏—Ö" —Ç–∞–±–ª–∏—Ü –≤ "–¥–ª–∏–Ω–Ω—ã–µ" –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç

# –û—Å–Ω–æ–≤–Ω—ã–µ:
pivot_wider()   # –∏–∑ –¥–ª–∏–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã –≤ —à–∏—Ä–æ–∫—É—é
pivot_longer()  # –∏–∑ —à–∏—Ä–æ–∫–æ–π —Ñ–æ—Ä–º—ã –≤ –¥–ª–∏–Ω–Ω—É—é
separate()      # —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ
unite()         # –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ –æ–¥–Ω—É

# –í –Ω–∞—à–µ–º —Å–∫—Ä–∏–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tidyr –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

---

## –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø

### üìå –°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏

```r
analyze_mtDNA_repeats <- function(
    fasta_path,           # –ø—É—Ç—å –∫ FASTA-—Ñ–∞–π–ª—É
    pos,                  # –ø–æ–∑–∏—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ (1-based)
    ref_nuc,              # –±—É–∫–≤–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ –Ω—É–∫–ª–µ–æ—Ç–∏–¥–∞ ("T", "C", "A", "G")
    alt_nuc,              # –±—É–∫–≤–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –Ω—É–∫–ª–µ–æ—Ç–∏–¥–∞
    max_flank_left = 20,  # –º–∞–∫—Å–∏–º—É–º –Ω—É–∫–ª–µ–æ—Ç–∏–¥–æ–≤ —Å–ª–µ–≤–∞ –æ—Ç pos
    max_flank_right = 20, # –º–∞–∫—Å–∏–º—É–º –Ω—É–∫–ª–µ–æ—Ç–∏–¥–æ–≤ —Å–ø—Ä–∞–≤–∞ –æ—Ç pos
    min_length = 5,       # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –º–æ—Ç–∏–≤–∞
    mismatch_percent = 0.2,     # –¥–æ–ª—è –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –æ—à–∏–±–æ–∫ (20%)
    major_arc_start,      # –Ω–∞—á–∞–ª–æ "major arc" —Ä–µ–≥–∏–æ–Ω–∞
    major_arc_end,        # –∫–æ–Ω–µ—Ü "major arc" —Ä–µ–≥–∏–æ–Ω–∞
    output_path = "../data/2_derived/",  # –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    output_prefix = "repeatability_results") {  # –ø—Ä–µ—Ñ–∏–∫—Å —Ñ–∞–π–ª–æ–≤
  
  # –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–¥–µ—Å—å...
}
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|-----|---------|--------|
| `fasta_path` | —Å—Ç—Ä–æ–∫–∞ | –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É | `"../data/1_raw/Homo_sapients.mtDNA.fasta"` |
| `pos` | —á–∏—Å–ª–æ | –ø–æ–∑–∏—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–∞ –î–ù–ö | `8473` |
| `ref_nuc` | —Å—Ç—Ä–æ–∫–∞ | –∏—Å—Ö–æ–¥–Ω–∞—è –±—É–∫–≤–∞ | `"T"` |
| `alt_nuc` | —Å—Ç—Ä–æ–∫–∞ | –º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±—É–∫–≤–∞ | `"C"` |
| `max_flank_left` | —á–∏—Å–ª–æ | –º–∞–∫—Å. —Ñ–ª–∞–Ω–∫ –≤–ª–µ–≤–æ | `20` |
| `max_flank_right` | —á–∏—Å–ª–æ | –º–∞–∫—Å. —Ñ–ª–∞–Ω–∫ –≤–ø—Ä–∞–≤–æ | `20` |
| `min_length` | —á–∏—Å–ª–æ | –º–∏–Ω. –¥–ª–∏–Ω–∞ –º–æ—Ç–∏–≤–∞ | `5` |
| `mismatch_percent` | –¥—Ä–æ–±—å | –¥–æ–ª—è –æ—à–∏–±–æ–∫ | `0.2` (20%) |
| `major_arc_start` | —á–∏—Å–ª–æ | –Ω–∞—á–∞–ª–æ —Ä–µ–≥–∏–æ–Ω–∞ | `5798` |
| `major_arc_end` | —á–∏—Å–ª–æ | –∫–æ–Ω–µ—Ü —Ä–µ–≥–∏–æ–Ω–∞ | `16568` |
| `output_path` | —Å—Ç—Ä–æ–∫–∞ | –ø–∞–ø–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | `"../data/2_derived/"` |
| `output_prefix` | —Å—Ç—Ä–æ–∫–∞ | –ø—Ä–µ—Ñ–∏–∫—Å —Ñ–∞–π–ª–æ–≤ | `"my_mtDNA_repeat"` |

---

## –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò

### üîß –§—É–Ω–∫—Ü–∏—è 1: get_motif_around_position

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫—É—Å–æ–∫ –î–ù–ö –≤–æ–∫—Ä—É–≥ –ø–æ–∑–∏—Ü–∏–∏

```r
get_motif_around_position <- function(seq, pos, left_flank, right_flank) {
  # seq: –æ–±—ä–µ–∫—Ç DNAString (–≤—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
  # pos: –ø–æ–∑–∏—Ü–∏—è (1-based, –∫–∞–∫ –≤ –±–∏–æ–ª–æ–≥–∏–∏)
  # left_flank: —Å–∫–æ–ª—å–∫–æ –Ω—É–∫–ª–µ–æ—Ç–∏–¥–æ–≤ –≤–∑—è—Ç—å —Å–ª–µ–≤–∞
  # right_flank: —Å–∫–æ–ª—å–∫–æ –Ω—É–∫–ª–µ–æ—Ç–∏–¥–æ–≤ –≤–∑—è—Ç—å —Å–ø—Ä–∞–≤–∞
  
  # –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª–æ: pos - left_flank, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 1
  start_pos <- max(pos - left_flank, 1)
  
  # –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–Ω–µ—Ü: pos + right_flank, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ –¥–ª–∏–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  end_pos <- min(pos + right_flank, length(seq))
  
  # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–¥—Å—Ç—Ä–æ–∫—É (–æ–±—ä–µ–∫—Ç DNAString)
  subseq(seq, start = start_pos, end = end_pos)
}
```

**–ü—Ä–∏–º–µ—Ä:**
```r
# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ATGCATGC (–ø–æ–∑–∏—Ü–∏–∏ 1-8)
#                     12345678
# pos = 5, left_flank = 2, right_flank = 2
# –†–µ–∑—É–ª—å—Ç–∞—Ç: subseq –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ 3 –¥–æ 7 = "CATGC"
```

---

### üîß –§—É–Ω–∫—Ü–∏—è 2: find_approximate_repeats

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏, –≥–¥–µ –≤ –î–ù–ö –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è "–ø–æ—Ö–æ–∂–∏–π" –Ω–∞ –º–æ—Ç–∏–≤ –∫—É—Å–æ–∫

```r
find_approximate_repeats <- function(seq, motif, max_mismatch) {
  # seq: –ø–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å DNAString
  # motif: –∏—Å–∫–æ–º—ã–π –∫—É—Å–æ–∫ DNAString
  # max_mismatch: –º–∞–∫—Å. –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –º–æ—Ç–∏–≤–æ–º –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∫—É—Å–∫–æ–º
  
  # –®–∞–≥ 1: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–æ—Ç–∏–≤ –≤ –æ–±—ã—á–Ω—É—é —Å—Ç—Ä–æ–∫—É
  motif_str <- as.character(motif)
  
  # –®–∞–≥ 2: –£–∑–Ω–∞—ë–º –¥–ª–∏–Ω—É –º–æ—Ç–∏–≤–∞
  motif_length <- nchar(motif_str)
  # nchar("AGCT") = 4
  
  # –®–∞–≥ 3: –£–∑–Ω–∞—ë–º –¥–ª–∏–Ω—É –ø–æ–ª–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  seq_length <- length(seq)
  
  # –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –í–°–ï –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ (k-mers) –¥–ª–∏–Ω—ã motif_length
  # substring(string, start_positions, end_positions)
  # –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ motif_length=3:
  #   substring("AGCTAG", 1:4, 3:6) –¥–∞–µ—Ç ("AGC", "GCT", "CTA", "TAG")
  all_kmers <- substring(
    as.character(seq),
    1:(seq_length - motif_length + 1),
    motif_length:(seq_length)
  )
  
  # –®–∞–≥ 5: –°—á–∏—Ç–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –•—ç–º–º–∏–Ω–≥–∞ –æ—Ç –º–æ—Ç–∏–≤–∞ –¥–æ –∫–∞–∂–¥–æ–π k-mer
  distances <- stringdist(motif_str, all_kmers, method = "hamming")
  # distances ‚Äî –≤–µ–∫—Ç–æ—Ä —á–∏—Å–µ–ª: [0, 1, 2, 0, 1, ...]
  
  # –®–∞–≥ 6: –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã k-mer'–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ <= max_mismatch
  matches_pos <- which(distances <= max_mismatch)
  # which(c(0, 1, 2, 0) <= 1) –¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã [1, 2, 4]
  
  # –®–∞–≥ 7: –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–∞–º–∏ k-mer'—ã –∏ –∏—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
  matched_kmers <- all_kmers[matches_pos]
  
  # –®–∞–≥ 8: –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã (data.frame)
  data.frame(
    repeat.seq = matched_kmers,                    # —Å–∞–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–∞
    repeat.start = matches_pos,                    # –ø–æ–∑–∏—Ü–∏—è –Ω–∞—á–∞–ª–∞ –ø–æ–≤—Ç–æ—Ä–∞
    repeat.end = matches_pos + motif_length - 1,  # –ø–æ–∑–∏—Ü–∏—è –∫–æ–Ω—Ü–∞ –ø–æ–≤—Ç–æ—Ä–∞
    repeat.hamming.distance = distances[matches_pos],  # —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞
    stringsAsFactors = FALSE  # –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–∫—Ç–æ—Ä—ã
  )
}
```

**–ü—Ä–∏–º–µ—Ä:**
```r
# motif = "AG", seq = "AGCTAGA"
# –í—Å–µ 2-–º–µ—Ä—ã: AG, GC, CT, TA, AG, GA
# –ï—Å–ª–∏ max_mismatch = 0 (—Ä–æ–≤–Ω–æ —Ç–∞–∫–∞—è –∂–µ):
#   –°–æ–≤–ø–∞–¥–µ–Ω–∏—è: –ø–æ–∑–∏—Ü–∏–∏ 1 –∏ 5 (–æ–±–∞ "AG")
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
#   repeat.seq: ["AG", "AG"]
#   repeat.start: [1, 5]
#   repeat.end: [2, 6]
#   repeat.hamming.distance: [0, 0]
```

---

### üîß –§—É–Ω–∫—Ü–∏—è 3: get_repeatability_table

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –í–°–ï –ø–æ–≤—Ç–æ—Ä—ã –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–æ—Ç–∏–≤–æ–≤

```r
get_repeatability_table <- function(seq, pos, ref_nuc, alt_nuc,
                                    min_length, max_flank_left, max_flank_right, 
                                    mismatch_percent) {
  all_results <- data.frame()  # —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞
  
  # –¶–∏–∫–ª 1: –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –¥–≤—É–º –∞–ª–ª–µ–ª—è–º (Ref –∏ Alt)
  for (allele in c(ref_nuc, alt_nuc)) {
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∫—É –¥–ª—è —ç—Ç–æ–π –∞–ª–ª–µ–ª–∏
    allele_label <- ifelse(allele == ref_nuc, "Ref", "Alt")
    
    # –ù–∞—á–∏–Ω–∞–µ–º —Å –∏—Å—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    seq_allele <- seq
    
    # –ï—Å–ª–∏ —ç—Ç–æ NOT referens–Ω–∞—è –∞–ª–ª–µ–ª—å, –∑–∞–º–µ–Ω—è–µ–º –Ω—É–∫–ª–µ–æ—Ç–∏–¥ –≤ –ø–æ–∑–∏—Ü–∏–∏ pos
    if (allele != ref_nuc) {
      # –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±—É–∫–≤—ã
      seq_chars <- unlist(strsplit(as.character(seq), split = ""))
      # –ó–∞–º–µ–Ω—è–µ–º –±—É–∫–≤—É –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ pos
      seq_chars[pos] <- allele
      # –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ DNAString
      seq_allele <- DNAString(paste(seq_chars, collapse = ""))
    }
    
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –º–æ—Ç–∏–≤–∞ = sum of flanks + 1 (—Å–∞–º –Ω—É–∫–ª–µ–æ—Ç–∏–¥)
    motif_max_length <- max_flank_left + max_flank_right + 1
    
    # –¶–∏–∫–ª 2: –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–ª–∏–Ω—ã –º–æ—Ç–∏–≤–∞
    for (motif_len in min_length:motif_max_length) {
      
      # –¶–∏–∫–ª 3: –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–ª–∞–Ω–∫–æ–≤
      for (left_flank in 0:(motif_len - 1)) {
        right_flank <- motif_len - left_flank - 1
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç –ª–∏ —Ñ–ª–∞–Ω–∫–∏ –ª–∏–º–∏—Ç—ã
        if (left_flank <= max_flank_left && right_flank <= max_flank_right) {
          
          # –ò–∑–≤–ª–µ–∫–∞–µ–º –º–æ—Ç–∏–≤
          motif_seq <- get_motif_around_position(seq_allele, pos, left_flank, right_flank)
          motif_string <- as.character(motif_seq)
          this_length <- nchar(motif_string)
          
          # –í—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å. –¥–æ–ø—É—Å—Ç–∏–º–æ–µ —á–∏—Å–ª–æ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20% –æ—Ç –¥–ª–∏–Ω—ã)
          max_mismatch_allowed <- floor(mismatch_percent * this_length)
          
          # –ò—â–µ–º –ø–æ–≤—Ç–æ—Ä—ã —ç—Ç–æ–≥–æ –º–æ—Ç–∏–≤–∞
          repeats_df <- find_approximate_repeats(seq_allele, motif_seq, max_mismatch_allowed)
          
          # –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–≤—Ç–æ—Ä...
          if (nrow(repeats_df) > 0) {
            # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ—Ç–∏–≤–µ
            repeats_df$motif.seq <- motif_string
            repeats_df$motif.length <- this_length
            repeats_df$motif.start <- max(pos - left_flank, 1)
            repeats_df$motif.end <- min(pos + right_flank, length(seq_allele))
            repeats_df$nuc <- allele
            repeats_df$RefAlt <- allele_label
            repeats_df$pos <- pos
            
            # –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏
            repeats_df <- repeats_df[, c(
              "pos", "nuc", "RefAlt", "motif.seq", "motif.length", 
              "motif.start", "motif.end",
              "repeat.seq", "repeat.start", "repeat.end", "repeat.hamming.distance"
            )]
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Ç–æ–≥–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
            all_results <- rbind(all_results, repeats_df)
          }
        }
      }
    }
  }
  
  # –û—á–∏—â–∞–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ (—á—Ç–æ–±—ã –Ω—É–º–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ —Å–∫–≤–æ–∑–Ω–∞—è)
  rownames(all_results) <- NULL
  return(all_results)
}
```

**–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
–¢–∞–±–ª–∏—Ü–∞ (data.frame) —Å–æ —Å—Ç–æ–ª–±—Ü–∞–º–∏:
```
pos | nuc | RefAlt | motif.seq | motif.length | motif.start | motif.end | 
repeat.seq | repeat.start | repeat.end | repeat.hamming.distance
```

---

### üîß –§—É–Ω–∫—Ü–∏—è 4: filter_self_overlaps

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ –º–æ—Ç–∏–≤ –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ø–æ–≤—Ç–æ—Ä –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è

```r
filter_self_overlaps <- function(df) {
  # –£—Å–ª–æ–≤–∏–µ: –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –º–æ—Ç–∏–≤ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –î–û –Ω–∞—á–∞–ª–∞ –ø–æ–≤—Ç–æ—Ä–∞
  #          –ò–õ–ò –ø–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –î–û –Ω–∞—á–∞–ª–∞ –º–æ—Ç–∏–≤–∞
  df %>% filter(motif.end < repeat.start | repeat.end < motif.start)
}

# –ü—Ä–∏–º–µ—Ä:
# –ú–æ—Ç–∏–≤: [100, 120]
# –ü–æ–≤—Ç–æ—Ä: [130, 150]  -> –æ—Å—Ç–∞–≤–ª—è–µ–º (–Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è)
# –ü–æ–≤—Ç–æ—Ä: [110, 130]  -> —É–¥–∞–ª—è–µ–º (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è)
# –ü–æ–≤—Ç–æ—Ä: [80, 110]   -> —É–¥–∞–ª—è–µ–º (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è)
```

---

### üîß –§—É–Ω–∫—Ü–∏—è 5: remove_nested_repeats

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–¥–∞–ª—è–µ—Ç "–≤–ª–æ–∂–µ–Ω–Ω—ã–µ" –ø–æ–≤—Ç–æ—Ä—ã (–∫–æ—Ä–æ—Ç–∫–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–æ–ª—å—à–∏—Ö)

```r
remove_nested_repeats <- function(repeats_df) {
  filtered_repeats <- data.frame()  # —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  
  # –î–ª—è –∫–∞–∂–¥–æ–π –∞–ª–ª–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
  for (allele in unique(repeats_df$nuc)) {
    # –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —ç—Ç–æ–π –∞–ª–ª–µ–ª–∏
    allele_repeats <- repeats_df %>% filter(nuc == allele)
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ EffectiveLength: –æ—Ç –±–æ–ª—å—à–∏—Ö –∫ –º–∞–ª—ã–º
    allele_repeats <- allele_repeats %>% arrange(desc(EffectiveLength))
    
    # –ü—É—Å—Ç–æ –≤ –Ω–∞—á–∞–ª–µ
    kept_intervals <- IRanges()
    
    # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –ø–æ–≤—Ç–æ—Ä—ã –≤ –ø–æ—Ä—è–¥–∫–µ —É–º–µ–Ω—å—à–µ–Ω–∏—è –¥–ª–∏–Ω—ã
    for (i in seq_len(nrow(allele_repeats))) {
      current_start <- allele_repeats$repeat.start[i]
      current_end <- allele_repeats$repeat.end[i]
      current_range <- IRanges(start = current_start, end = current_end)
      
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–≤—Ç–æ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö?
      is_nested <- if (length(kept_intervals) == 0) FALSE else
        any(start(current_range) >= start(kept_intervals) & 
            end(current_range) <= end(kept_intervals))
      
      # –ï—Å–ª–∏ –Ω–µ –≤–ª–æ–∂–µ–Ω ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤ kept_intervals
      if (!is_nested) {
        filtered_repeats <- rbind(filtered_repeats, allele_repeats[i, ])
        kept_intervals <- c(kept_intervals, current_range)
      }
    }
  }
  
  rownames(filtered_repeats) <- NULL
  return(filtered_repeats)
}

# –ü—Ä–∏–º–µ—Ä:
# –ü–æ–≤—Ç–æ—Ä 1: [100, 150], EffectiveLength = 50  -> –æ—Å—Ç–∞–≤–ª—è–µ–º
# –ü–æ–≤—Ç–æ—Ä 2: [110, 130], EffectiveLength = 20  -> —É–¥–∞–ª—è–µ–º (–≤–Ω—É—Ç—Ä–∏ –ü–æ–≤—Ç–æ—Ä–∞ 1)
# –ü–æ–≤—Ç–æ—Ä 3: [200, 250], EffectiveLength = 30  -> –æ—Å—Ç–∞–≤–ª—è–µ–º (–Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å 1)
```

---

## –ü–û–®–ê–ì–û–í–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï –ü–ê–ô–ü–õ–ê–ô–ù–ê

### üìç –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```r
# –ï—Å–ª–∏ –ø–∞–ø–∫–∞ output_path –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞—ë–º –µ—ë
if(!dir.exists(output_path)) dir.create(output_path, recursive = TRUE)

# –°–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∞–ø–∫—É, —É–Ω–∏–∫–∞–ª—å–Ω—É—é –¥–ª—è —ç—Ç–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
folder_name <- paste0("pos", pos, "_", ref_nuc, "to", alt_nuc)
# –ü—Ä–∏–º–µ—Ä: "pos8473_TtoC"

full_output_dir <- file.path(output_path, folder_name)
# –°–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
if (!dir.exists(full_output_dir)) dir.create(full_output_dir)
```

---

### üìç –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ FASTA-—Ñ–∞–π–ª–∞

```r
# –ß–∏—Ç–∞–µ–º FASTA
mtDNA <- readDNAStringSet(fasta_path)
# mtDNA ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç DNAStringSet (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
if (length(mtDNA) != 1) stop("Fasta must contain exactly one sequence.")
# length(mtDNA) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –≤ –Ω–∞–±–æ—Ä–µ

# –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–≤—É—é (–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é) –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
seq <- mtDNA[[1]]
# seq —Ç–µ–ø–µ—Ä—å ‚Äî –æ–±—ä–µ–∫—Ç DNAString (–≤—Å—è mtDNA)
```

---

### üìç –®–∞–≥ 3: –°–±–æ—Ä –≤—Å–µ—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤

```r
# –í—ã–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å–±–æ—Ä–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤
all_repeats <- get_repeatability_table(seq, pos, ref_nuc, alt_nuc,
                                       min_length, max_flank_left, max_flank_right, 
                                       mismatch_percent)
# all_repeats ‚Äî –±–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ –í–°–ï–ú–ò –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –ø–æ–≤—Ç–æ—Ä–∞–º–∏
# –¥–ª—è –≤—Å–µ—Ö –º–æ—Ç–∏–≤–æ–≤, –¥–ª—è –æ–±–µ–∏—Ö –∞–ª–ª–µ–ª–µ–π
```

---

### üìç –®–∞–≥ 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è self-overlaps

```r
# –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–≤—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –º–æ—Ç–∏–≤–æ–º
filtered_repeats <- filter_self_overlaps(all_repeats)
# all_repeats -> filtered_repeats (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –æ–±—ã—á–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è)
```

---

### üìç –®–∞–≥ 5: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ EffectiveLength

```r
# EffectiveLength = "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è" –¥–ª–∏–Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
# = –¥–ª–∏–Ω–∞ –º–æ—Ç–∏–≤–∞ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–∏–π
# –°–º—ã—Å–ª: –µ—Å–ª–∏ –º–æ—Ç–∏–≤ –¥–ª–∏–Ω—ã 10, –Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å 2 –æ—à–∏–±–∫–∞–º–∏,
#        —Ç–æ "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –¥–ª–∏–Ω–∞" = 10 - 2 = 8

filtered_repeats$EffectiveLength <- 
  filtered_repeats$motif.length - filtered_repeats$repeat.hamming.distance
```

---

### üìç –®–∞–≥ 6: –£–¥–∞–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤

```r
# –î–ª—è –∫–∞–∂–¥–æ–π –∞–ª–ª–µ–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ "–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ" –ø–æ–≤—Ç–æ—Ä—ã
# (—É–¥–∞–ª—è–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–æ–ª—å—à–∏—Ö)
non_nested_repeats <- remove_nested_repeats(filtered_repeats)
```

---

### üìç –®–∞–≥ 7: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —É—Ä–æ–≤–Ω–µ–π —Ñ–∞–∫—Ç–æ—Ä–∞

```r
# –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞: –ø—É—Å—Ç—å Ref –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥ Alt
non_nested_repeats$RefAlt <- factor(non_nested_repeats$RefAlt, 
                                    levels = c("Ref", "Alt"))
```

---

### üìç –®–∞–≥ 8: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

```r
# –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é EffectiveLength, –∑–∞—Ç–µ–º –ø–æ RefAlt
all_repeats_sorted <- non_nested_repeats %>%
  arrange(desc(EffectiveLength), RefAlt)
```

---

## –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –û–ë–†–ê–ë–û–¢–ö–ê

### Major Arc Filtering

```r
# "Major arc" ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–≥–∏–æ–Ω mtDNA (–æ–±—ã—á–Ω–æ 5798‚Äì16568)
# –≠—Ç–æ —Ä–µ–≥–∏–æ–Ω, –≥–¥–µ –æ–∂–∏–¥–∞—é—Ç –Ω–∞–π—Ç–∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ –ø–æ–≤—Ç–æ—Ä—ã

major_arc_repeats <- non_nested_repeats %>%
  filter(
    repeat.start >= major_arc_start, 
    repeat.end <= major_arc_end
  )
# –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–≤—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ü–µ–ª–∏–∫–æ–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ major arc
```

---

### Top-5 Summary

```r
# –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä—ã –ø–æ EffectiveLength –∏ —Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–π –∞–ª–ª–µ–ª–∏
top5_lengths <- major_arc_repeats %>%
  group_by(RefAlt, EffectiveLength) %>%
  summarise(Count = n(), .groups = "drop") %>%
  filter(EffectiveLength > 0) %>%
  arrange(desc(EffectiveLength)) %>%
  group_by(RefAlt) %>%
  mutate(rank = row_number()) %>%
  ungroup() %>%
  filter(rank <= 5)

# –ë–µ—Ä—ë–º 5 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö EffectiveLength
efflen_top <- unique(sort(top5_lengths$EffectiveLength, decreasing = TRUE))[1:5]

# –°–æ–±–∏—Ä–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É (—à–∏—Ä–æ–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
summary_table <- tibble(EffectiveLength = efflen_top) %>%
  left_join(top5_lengths %>% filter(RefAlt == "Ref") %>%
              select(EffectiveLength, Ref_Count = Count), 
            by = "EffectiveLength") %>%
  left_join(top5_lengths %>% filter(RefAlt == "Alt") %>%
              select(EffectiveLength, Alt_Count = Count), 
            by = "EffectiveLength") %>%
  mutate(
    Ref_Count = ifelse(is.na(Ref_Count), 0, Ref_Count),
    Alt_Count = ifelse(is.na(Alt_Count), 0, Alt_Count)
  )
```

---

### –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```r
# –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–≤–µ CSV-—Ç–∞–±–ª–∏—Ü—ã
write.csv(all_repeats_sorted,
          file = file.path(full_output_dir, 
                           paste0(output_prefix, "_all_repeats.csv")),
          row.names = FALSE)

write.csv(summary_table,
          file = file.path(full_output_dir, 
                           paste0(output_prefix, "_major_arc_summary_top5.csv")),
          row.names = FALSE)
```

---

## –ì–õ–û–°–°–ê–†–ò–ô R-–°–ò–ù–¢–ê–ö–°–ò–°–ê

### üî† –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|----------|-------------|--------|
| `<-` | –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ | `x <- 5` (x —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 5) |
| `=` | –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ (–≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö) | `function(x = 5)` |
| `==` | —Ä–∞–≤–Ω–æ? | `x == 5` (TRUE/FALSE) |
| `!=` | –Ω–µ —Ä–∞–≤–Ω–æ? | `x != 5` |
| `<`, `>` | –º–µ–Ω—å—à–µ/–±–æ–ª—å—à–µ | `x < 10` |
| `<=`, `>=` | –º–µ–Ω—å—à–µ-—Ä–∞–≤–Ω–æ/–±–æ–ª—å—à–µ-—Ä–∞–≤–Ω–æ | `x <= 10` |
| `&` | –ò –ª–æ–≥–∏—á–µ—Å–∫–æ–µ | `(x > 5) & (y < 10)` |
| `\|` | –ò–õ–ò –ª–æ–≥–∏—á–µ—Å–∫–æ–µ | `(x > 5) | (y < 10)` |
| `!` | –ù–ï –ª–æ–≥–∏—á–µ—Å–∫–æ–µ | `!(x > 5)` |

---

### üì¶ –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `as.character()` | –ø—Ä–µ–æ–±—Ä–∞–∑—É–π –≤ —Å—Ç—Ä–æ–∫—É | `as.character(123)` ‚Üí `"123"` |
| `nchar()` | –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ | `nchar("AGCT")` ‚Üí `4` |
| `substring()` | –≤—ã—Ä–µ–∑—å –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ | `substring("AGCT", 1:3, 2:4)` ‚Üí `("AG", "GC", "CT")` |
| `paste()` | —Å–∫–ª–µ–π —Å—Ç—Ä–æ–∫–∏ | `paste("A", "G", sep="")` ‚Üí `"AG"` |
| `strsplit()` | —Ä–∞–∑–±–µ–π —Å—Ç—Ä–æ–∫—É | `strsplit("A-G-C", "-")` ‚Üí `list("A", "G", "C")` |
| `toupper()` | –≤ –ó–ê–ì–õ–ê–í–ù–´–ï | `toupper("agct")` ‚Üí `"AGCT"` |

---

### üìä –†–∞–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `c()` | —Å–æ–∑–¥–∞–π –≤–µ–∫—Ç–æ—Ä | `c(1, 2, 3)` ‚Üí `[1, 2, 3]` |
| `length()` | –¥–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞ | `length(c(1, 2, 3))` ‚Üí `3` |
| `max()`, `min()` | –º–∞–∫—Å–∏–º—É–º/–º–∏–Ω–∏–º—É–º | `max(c(1, 5, 3))` ‚Üí `5` |
| `sum()` | —Å—É–º–º–∞ | `sum(c(1, 2, 3))` ‚Üí `6` |
| `which()` | –∏–Ω–¥–µ–∫—Å—ã, –≥–¥–µ TRUE | `which(c(T, F, T))` ‚Üí `c(1, 3)` |
| `sort()` | –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π | `sort(c(3, 1, 2))` ‚Üí `c(1, 2, 3)` |

---

### üìã –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ (data.frame)

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `data.frame()` | —Å–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É | `data.frame(x=c(1,2), y=c("a","b"))` |
| `nrow()`, `ncol()` | —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫/—Å—Ç–æ–ª–±—Ü–æ–≤ | `nrow(df)` ‚Üí `2` |
| `colnames()` | –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ | `colnames(df)` |
| `df$col` | –¥–æ—Å—Ç—É–ø –∫ —Å—Ç–æ–ª–±—Ü—É | `df$x` ‚Üí –≤–µ–∫—Ç–æ—Ä |
| `df[i, j]` | –¥–æ—Å—Ç—É–ø –∫ —è—á–µ–π–∫–µ | `df[1, 2]` ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫–µ 1, —Å—Ç–æ–ª–±—Ü–µ 2 |
| `rbind()` | —Å–∫–ª–µ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ —Å—Ç—Ä–æ–∫–∞–º | `rbind(df1, df2)` |
| `write.csv()` | —Å–æ—Ö—Ä–∞–Ω–∏ –≤ CSV | `write.csv(df, "file.csv")` |

---

### üîó Pipe-–æ–ø–µ—Ä–∞—Ç–æ—Ä %>%

```r
# –≠—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏–∑ dplyr, –ø–æ–∑–≤–æ–ª—è–µ—Ç "—Ü–µ–ø–ª—è—Ç—å" —Ñ—É–Ω–∫—Ü–∏–∏

# –ë–µ–∑ pipe:
result <- filter(df, x > 5)
result <- select(result, col1, col2)

# –° pipe:
result <- df %>%
  filter(x > 5) %>%
  select(col1, col2)

# –ß–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫: "df, –ø–æ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ x > 5, –ø–æ—Ç–æ–º –≤—ã–±–µ—Ä–∏ —Å—Ç–æ–ª–±—Ü—ã col1 –∏ col2"
```

---

### üéØ –§—É–Ω–∫—Ü–∏–∏ dplyr

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `filter()` | –æ—Å—Ç–∞–≤—å —Å—Ç—Ä–æ–∫–∏ | `df %>% filter(x > 5)` |
| `select()` | –≤—ã–±–µ—Ä–∏ —Å—Ç–æ–ª–±—Ü—ã | `df %>% select(col1, col2)` |
| `mutate()` | –¥–æ–±–∞–≤—å/–∏–∑–º–µ–Ω–∏ —Å—Ç–æ–ª–±–µ—Ü | `df %>% mutate(new = x + y)` |
| `arrange()` | –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π | `df %>% arrange(x)` –∏–ª–∏ `arrange(desc(x))` |
| `group_by()` | –≥—Ä—É–ø–ø–∏—Ä—É–π | `df %>% group_by(category)` |
| `summarise()` | –∞–≥—Ä–µ–≥–∏—Ä—É–π | `df %>% summarise(mean_x = mean(x))` |
| `left_join()` | —Å–æ–µ–¥–∏–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã | `df1 %>% left_join(df2, by="key")` |

---

### üî¥ –£—Å–ª–æ–≤–∏—è –∏ —Ü–∏–∫–ª—ã

```r
# If-else
if (condition) {
  # –∫–æ–¥, –µ—Å–ª–∏ TRUE
} else {
  # –∫–æ–¥, –µ—Å–ª–∏ FALSE
}

# For-loop
for (i in 1:5) {
  print(i)
}

# While-loop
while (condition) {
  # –∫–æ–¥
}

# Ifelse (–≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
result <- ifelse(x > 5, "yes", "no")
```

---

### üìå –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Biostrings

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `readDNAStringSet()` | –ø—Ä–æ—á–∏—Ç–∞–π FASTA | `readDNAStringSet("file.fasta")` |
| `DNAString()` | —Å–æ–∑–¥–∞–π DNAString | `DNAString("AGCT")` |
| `subseq()` | –≤—ã—Ä–µ–∑—å –ø–æ–¥—Å—Ç—Ä–æ–∫—É | `subseq(seq, start=1, end=4)` |
| `as.character()` | –ø—Ä–µ–æ–±—Ä–∞–∑—É–π –≤ —Å—Ç—Ä–æ–∫—É | `as.character(DNAString("AGCT"))` ‚Üí `"AGCT"` |
| `length()` | –¥–ª–∏–Ω–∞ (–¥–ª—è DNAString) | `length(seq)` |

---

### üìå –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ IRanges

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –ü—Ä–∏–º–µ—Ä |
|---------|-----------|--------|
| `IRanges()` | —Å–æ–∑–¥–∞–π –∏–Ω—Ç–µ—Ä–≤–∞–ª | `IRanges(start=10, end=20)` |
| `start()`, `end()` | –ø–æ–ª—É—á–∏ –Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü | `start(range)` ‚Üí `10` |
| `overlapsAny()` | –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –ª–∏? | `overlapsAny(range1, range2)` |

---

## –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò –ü–†–û–í–ï–†–ò–¢–¨

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å R

```r
# –û—Ç–∫—Ä–æ–π R –∫–æ–Ω—Å–æ–ª—å
# –í—ã–ø–æ–ª–Ω–∏:
source("scripts/03.RefAltRepeatability.Function.R")

# –ü–æ—Ç–æ–º –≤—ã–∑–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é:
result <- analyze_mtDNA_repeats(
  fasta_path = "data/1_raw/Homo_sapients.mtDNA.fasta",
  pos = 8473,
  ref_nuc = "T",
  alt_nuc = "C",
  max_flank_left = 20,
  max_flank_right = 20,
  min_length = 5,
  mismatch_percent = 0.2,
  major_arc_start = 5798,
  major_arc_end = 16568,
  output_path = "data/2_derived/",
  output_prefix = "my_mtDNA_repeat"
)

# –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
result$all_repeats  # –≤—Å–µ –ø–æ–≤—Ç–æ—Ä—ã
result$summary_top5_major_arc  # top-5 summary
```

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Rscript (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

```bash
# –í PowerShell:
cd C:\proga\REPEATABILITY
Rscript.exe scripts/03.RefAltRepeatability.Function.R

# –ò–ª–∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –ø—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏:
# source("scripts/03.RefAltRepeatability.Function.R")
```

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ –∏–∑ Python

```r
# –ò–∑ python/run_compare_pos8473.py –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è R-—Ñ—É–Ω–∫—Ü–∏—è
# (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã rpy2 –∏–ª–∏ –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
```

---

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å:

```r
# 1. –°–æ–∑–¥–∞–ª–∞—Å—å –ª–∏ –ø–∞–ø–∫–∞?
dir.exists("data/2_derived/pos8473_TtoC/")  # –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å TRUE

# 2. –°–æ–∑–¥–∞–Ω—ã –ª–∏ —Ñ–∞–π–ª—ã?
file.exists("data/2_derived/pos8473_TtoC/my_mtDNA_repeat_all_repeats.csv")
file.exists("data/2_derived/pos8473_TtoC/my_mtDNA_repeat_major_arc_summary_top5.csv")

# 3. –û—Ç–∫—Ä–æ–π –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
all_repeats <- read.csv("data/2_derived/pos8473_TtoC/my_mtDNA_repeat_all_repeats.csv")
head(all_repeats)  # –ø–µ—Ä–≤—ã–µ 6 —Å—Ç—Ä–æ–∫
dim(all_repeats)   # —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã (—Å—Ç—Ä–æ–∫–∏, —Å—Ç–æ–ª–±—Ü—ã)

summary_table <- read.csv("data/2_derived/pos8473_TtoC/my_mtDNA_repeat_major_arc_summary_top5.csv")
print(summary_table)
```

---

## üéì –ò–¢–û–ì–û–í–´–ô WORKFLOW

```
1. –ß—Ç–µ–Ω–∏–µ FASTA
   ‚Üì
2. –î–ª—è –∫–∞–∂–¥–æ–π –∞–ª–ª–µ–ª–∏ (Ref, Alt):
   ‚Üì
3. –î–ª—è –∫–∞–∂–¥–æ–π –¥–ª–∏–Ω—ã –º–æ—Ç–∏–≤–∞ (5‚Äì41 bp):
   ‚Üì
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–ª–∞–Ω–∫–æ–≤:
   ‚Üì
5. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞ around position
   ‚Üì
6. –ü–æ–∏—Å–∫ –≤—Å–µ—Ö k-mer'–æ–≤ –≤ –î–ù–ö
   ‚Üì
7. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –•—ç–º–º–∏–Ω–≥–∞
   ‚Üì
8. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ max_mismatch (20%)
   ‚Üì
9. –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É
   ‚Üì
10. –£–¥–∞–ª–µ–Ω–∏–µ self-overlaps
   ‚Üì
11. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ EffectiveLength
   ‚Üì
12. –£–¥–∞–ª–µ–Ω–∏–µ nested –ø–æ–≤—Ç–æ—Ä–æ–≤
   ‚Üì
13. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ major arc
   ‚Üì
14. –í—ã–±–æ—Ä top-5 –ø–æ EffectiveLength
   ‚Üì
15. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ CSV
```

---

## üÜò –†–ï–®–ï–ù–ò–ï –¢–ò–ü–ò–ß–ù–´–• –ü–†–û–ë–õ–ï–ú

### ‚ùå –û—à–∏–±–∫–∞: "Fasta must contain exactly one sequence."

**–†–µ—à–µ–Ω–∏–µ:** –í FASTA-—Ñ–∞–π–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π. –ü—Ä–æ–≤–µ—Ä—å:
```r
mtDNA <- readDNAStringSet("path/to/file.fasta")
length(mtDNA)  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1
names(mtDNA)   # –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
```

---

### ‚ùå –û—à–∏–±–∫–∞: "could not find function..."

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–±—ã–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É:
```r
library(dplyr)  # –∏–ª–∏ –∫–∞–∫–∞—è-—Ç–æ –∏–∑ —Ç—Ä–µ–±—É–µ–º—ã—Ö
```

---

### ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—É—Å—Ç—ã

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ú–æ–∂–µ—Ç –±—ã—Ç—å, –º–æ—Ç–∏–≤ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –î–ù–ö (–ø—Ä–∏ strict hamming_distance = 0)
2. –í—Å–µ –ø–æ–≤—Ç–æ—Ä—ã –≤–ª–æ–∂–µ–Ω—ã –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞
3. –û—à–∏–±–∫–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö (pos, ref_nuc, alt_nuc)

**–ü—Ä–æ–≤–µ—Ä—å:**
```r
# –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ pos –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π?
mtDNA <- readDNAStringSet("data/1_raw/Homo_sapients.mtDNA.fasta")
seq <- mtDNA[[1]]
length(seq)  # –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 16568 –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞

# –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã –ª–∏ –Ω—É–∫–ª–µ–æ—Ç–∏–¥—ã?
pos <- 8473
as.character(subseq(seq, pos, pos))  # –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "T" –¥–ª—è ref_nuc="T"
```

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

- **Biostrings –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `?Biostrings`
- **stringdist –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `?stringdist`
- **dplyr —à–ø–∞—Ä–≥–∞–ª–∫–∞:** https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf
- **R –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤:** https://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf

---

**–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! üéâ**
–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
